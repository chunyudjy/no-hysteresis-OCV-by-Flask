# HPPC and OCV Data for Equivalent circuit Modelling

Open Circuit Voltage(OCV) mainly depends on :

- **State of Charge (SoC):** OCV is a direct function of SoC, meaning as SoC increases, OCV also increases in a nonlinear manner. This relationship is determined by the Nernst equation and depends on the electrochemical potential of the electrodes. Each battery chemistry has a characteristic OCV-SoC curve.
OCV æ˜¯ SoC çš„æ­£å‡½æ•°ï¼Œè¿™æ„å‘³ç€éšç€ SoC çš„å¢åŠ ï¼ŒOCV ä¹Ÿä¼šä»¥éçº¿æ€§æ–¹å¼å¢åŠ ã€‚è¯¥å…³ç³»ç”±èƒ½æ–¯ç‰¹æ–¹ç¨‹ç¡®å®šï¼Œå¹¶å–å†³äºç”µæçš„ç”µåŒ–å­¦ç”µä½ã€‚æ¯ç§ç”µæ± åŒ–å­¦æ€§è´¨éƒ½æœ‰å…¶ç‰¹æœ‰çš„ OCV-SoC æ›²çº¿ã€‚

- **Temperature:** OCV varies with temperature due to changes in reaction kinetics and electrolyte conductivity. Higher temperatures generally reduce OCV slightly because of increased entropy effects, while lower temperatures increase OCV but may also slow down electrochemical reactions, affecting accuracy in SoC estimation.ç”±äºååº”åŠ¨åŠ›å­¦å’Œç”µè§£æ¶²ç”µå¯¼ç‡çš„å˜åŒ–ï¼ŒOCV ä¼šéšæ¸©åº¦å˜åŒ–ã€‚ç”±äºç†µæ•ˆåº”å¢å¼ºï¼Œè¾ƒé«˜çš„æ¸©åº¦é€šå¸¸ä¼šç•¥å¾®é™ä½ OCVï¼›è€Œè¾ƒä½çš„æ¸©åº¦ä¼šæé«˜ OCVï¼Œä½†ä¹Ÿå¯èƒ½å‡æ…¢ç”µåŒ–å­¦ååº”çš„é€Ÿåº¦ï¼Œä»è€Œå½±å“ SoC ä¼°ç®—çš„å‡†ç¡®æ€§ã€‚

It also depends on

- **Battery Chemistry**: Different battery chemistries (e.g., Li-ion, NiMH, lead-acid) have distinct OCV characteristics.

- **Aging/State of Health (SoH)**: As a battery degrades, its OCV curve may shift due to changes in internal resistance and capacity loss.

- **Hysteresis Effects**: Some battery chemistries exhibit OCV hysteresis, meaning the voltage depends on whether the battery was previously charged or discharged.

- **Electrode Material Properties**: The composition and structure of electrode materials influence the OCV by affecting ion intercalation/deintercalation.

- **Electrolyte Composition**: The type and concentration of electrolytes impact the chemical potential and, consequently, the OCV.

  

Would you like a more detailed explanation of how each factor influences OCV?

Battery modeling using **Hybrid Pulse Power Characterization (HPPC) and Open Circuit Voltage (OCV) data** involves several key steps:


### **1. Data Collection**

- **HPPC Test:** Perform charge/discharge pulses at different SoC levels to capture dynamic voltage response.

- **OCV Test:** Allow the battery to rest for a long period after charging/discharging to measure equilibrium voltage at different SoC points.

  

### **2. Data Preprocessing**

- Filter out noise from voltage and current signals.

- Align voltage, current, and temperature data with timestamps.

- Extract OCV-SoC data by identifying steady-state voltage after rest periods.

  

### **3. OCV-SoC Curve Fitting**

- Fit the OCV-SoC data to an empirical or polynomial function.

- Use methods like **lookup tables, spline interpolation, or regression models** to represent the OCV-SoC relationship.

  

### **4. Equivalent Circuit Model (ECM) Parameter Identification**

- Use HPPC test data to extract model parameters:

- **Internal Resistance (R0):** From the initial voltage drop after a pulse.

- **Polarization Resistance (R1, R2) and Capacitance (C1, C2):** Derived from voltage relaxation after current pulses.

- Apply **curve fitting or system identification methods** to estimate parameters.

  

### **5. Model Implementation & Validation**

- Implement the identified ECM (e.g., Thevenin or RC model) in **MATLAB, Simulink, or Python**.

- Simulate the battery voltage response under different load conditions.

- Validate the model using test data and compute error metrics (e.g., RMSE, MAE).
ä¸ºä»€ä¹ˆæ¸©åº¦â†‘ â†’â€¯OCVâ†“ï¼Ÿ
----
```md
**ä¸€å¥è¯æ‹†è§£**

|å…³é”®è¯|å«ä¹‰|å¯¹ OCV çš„å½±å“|
|---|---|---|
|**Higherâ€¯temperatures**|ç”µæ± æ¸©åº¦å‡é«˜|â‘ â€¯ä½“ç³»ç†µï¼ˆÎ”Sï¼‰â†‘ â‘¡â€¯OCVâ€¯ç•¥é™|
|**Increased entropy effects**|Î”S ä¸æ¸©åº¦é¡¹â€¯TÎ”Sâ€¯åœ¨â€¯Gâ€¯=â€¯Hâ€¯âˆ’â€¯TÎ”Sâ€¯ä¸­å æ¯”æ›´å¤§|å½“ Î”S <â€¯0ï¼ˆå¤šæ•°é”‚ç”µååº”å¦‚æ­¤ï¼‰ï¼Œâˆ’Î”S/nFâ€¯ä¸ºæ­£ï¼Œä½† Tâ€¯å¢å¤§å âˆ’TÎ”S/nFâ€¯é¡¹â€œåƒæ‰â€ä¸€éƒ¨åˆ†æ­£ç”µåŠ¿ â†’ OCV â†“|
|**Lowerâ€¯temperatures**|ç”µæ± æ¸©åº¦é™ä½|â‘ â€¯âˆ’TÎ”S/nFâ€¯é¡¹å‡å° â†’ OCVâ€¯ç•¥å‡ â‘¡â€¯ç”µåŒ–å­¦ååº”é€Ÿç‡â†“|
|**Slow down electrochemical reactions**|ç”µæ/ç”µè§£æ¶²ç•Œé¢çš„åŠ¨åŠ›å­¦å— Arrhenius è¡Œä¸ºæ”¯é…|å†…é˜» (Râ€¯=â€¯Râ‚€â€¯e^{Eâ‚/RT}) â†‘ï¼ŒæåŒ–ç”µå‹å˜å¤§|
|**Affecting accuracy in SoC estimation**|SoCâ€¯ä¼°ç®—å¸¸ç”¨â€¯OCVâ€“SoC æ›²çº¿|ä½æ¸©ä¸‹æµ‹å¾—çš„ç«¯ç”µå‹ = OCV + IR_dropï¼Œè‹¥ç›´æ¥å¥—å¸¸æ¸© OCVâ€“SoC è¡¨ï¼Œä¼šæŠŠ IR_drop å½“æˆ SoC åå·®ï¼Œå¯¼è‡´ä¼°ç®—å¤±çœŸ|

---

### 1â€¯|â€¯ä¸ºä»€ä¹ˆæ¸©åº¦â†‘ â†’â€¯OCVâ†“ï¼Ÿ

OCV çš„çƒ­åŠ›å­¦è¡¨è¾¾å¯ç”± Nernst æ–¹ç¨‹çš„æ¸©åº¦å¾®åˆ†å¾—åˆ°

(âˆ‚Eâˆ‚T)P=âˆ’Î”SnF\left(\frac{\partial E}{\partial T}\right)_P = -\frac{\Delta S}{nF}

å¤šæ•°é”‚ç¦»å­åµŒ/è„±ååº”çš„ Î”S ä¸º **è´Ÿå€¼**ã€‚

- Tâ†‘ â†’ å³å¼ç»å¯¹å€¼â†‘ï¼ŒE éš T å‘ˆ**è´Ÿæ–œç‡** â‡’ OCV ç•¥é™ã€‚
    
- å…¸å‹æ–œç‡ï¼šâˆ’0.15â€¯~â€¯âˆ’0.40â€¯mVâ€¯Kâ»Â¹ï¼Œ30â€¯Â°Câ€¯å‡åˆ°â€¯50â€¯Â°C ä»…é™ä½å‡ æ¯«ä¼ï¼Œä½† BMS ç²¾åº¦è¦æ±‚å¸¸ç”¨â€¯Â±2â€¯mV é‡çº§ï¼Œå› æ­¤è¦è¡¥å¿ã€‚
    

---

### 2â€¯|â€¯ä¸ºä»€ä¹ˆæ¸©åº¦â†“ â†’â€¯OCVâ†‘ ä½† SoC éš¾ç®—ï¼Ÿ

1. **OCVâ€¯å‡é«˜**
    
    - âˆ’TÎ”S/nF é¡¹ç¼©å° â‡’ E å¢å¤§ï¼Œæ›²çº¿æ•´ä½“ä¸Šç§»ã€‚
        
2. **åŠ¨åŠ›å­¦å˜æ…¢**
    
    - è¿ç§»ã€æ‰©æ•£ç³»æ•° ~â€¯e^{âˆ’Eâ‚/RT}ï¼ŒTâ†“ â†’ ååº”é˜»æŠ—â†‘
        
    - æ”¾ç”µæ—¶ç«¯ç”µå‹ = OCV âˆ’ IÂ·R_intï¼Œä½æ¸© R_int å¤§ â†’ ç«¯ç”µå‹å¤§å¹…æ‰å¤´ä¸‹æ»‘
        
    - å¦‚æœ BMS ä»æŒ‰å¸¸æ¸© OCVâ€“SoC æ›²çº¿è§£ç®—ï¼Œä¼šæŠŠè¿™éƒ¨åˆ† **IR æåŒ–è¯¯åˆ¤æˆ SoC ä¸‹é™** â‡’ å‰©ä½™ç”µé‡è¢«ä½ä¼°ã€‚
        

---

### 3â€¯|â€¯å·¥ç¨‹å¯ç¤º

|æ¸©åº¦åŒºé—´|éœ€å…³æ³¨|å¸¸è§è¡¥å¿ç­–ç•¥|
|---|---|---|
|**>â€¯40â€¯Â°C**|OCVâ€¯ç»†å¾®ä¸‹é™ï¼›å‰¯ååº”åŠ é€Ÿ|æ¸©åº¦ç³»æ•°æ ¡æ­£ (`dE/dT`)ï¼›çƒ­å¤±æ§é˜²æŠ¤|
|**0â€¯~â€¯40â€¯Â°C**|SoCâ€“OCV æ›²çº¿æ ‡å®šç‚¹|å®æ—¶æ¸©åº¦è¡¥å¿æ›²çº¿æ‹Ÿåˆ|
|**<â€¯0â€¯Â°C**|ç«¯ç”µå‹å¤§å¹…æåŒ–ï¼›å……ç”µå—é™|å†…é˜»åœ¨çº¿ä¼°è®¡ (EKF, OCVâ€‘R æ¨¡å‹) + ä½æ¸©é€€æµ/é™æµç­–ç•¥|

---

### 4â€¯|â€¯ä¸€å›¾é€Ÿè§ˆï¼ˆæ¦‚å¿µç¤ºæ„ï¼‰

```
          OCV
           â†‘
           â”‚       ï¼  (ä½æ¸©)
           â”‚      ï¼
           â”‚     ï¼
           â”‚    ï¼
           â”‚   ï¼ (å¸¸æ¸©)
           â”‚  ï¼
           â”‚ ï¼
           â”‚/ (é«˜æ¸©)
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  SoC
```

æ¸©åº¦è¶Šä½ï¼Œæ›²çº¿æ•´ä½“â€œæŠ¬é«˜â€ä¸”æ›´é™¡ï¼›è¶Šé«˜åˆ™â€œå‹ä½â€ä¸”æ›´å¹³ç¼“ã€‚

---

**æ€»ç»“**

- **çƒ­åŠ›å­¦å±‚é¢**ï¼šÎ”S æ˜¯ä¸»å› ï¼Œå†³å®š dE/dT çš„ç¬¦å·å’Œå¹…åº¦ã€‚
    
- **åŠ¨åŠ›å­¦å±‚é¢**ï¼šR_int çš„æ¸©åº¦ä¾èµ–è®©æµ‹å¾—çš„ç«¯ç”µå‹ â‰  çœŸæ­£çš„ OCVã€‚
    
- **BMS å®æˆ˜**ï¼šè¦åŒæ—¶åš **æ¸©åº¦ç³»æ•°è¡¥å¿ + å†…é˜»çº¿ä¸Šä¼°è®¡**ï¼Œå¦åˆ™ SoC åœ¨æç«¯æ¸©åº¦ä¸‹ä¼šç³»ç»Ÿæ€§åå·®ã€‚
```



# ä¸ºä»€ä¹ˆè¦ç”¨50%SOCçš„ç”µå‹å·®ï¼Œå…¶ä»–çš„ä¸å¯ä»¥å—ï¼Ÿ
ğŸ”‘ä¸ºä»€ä¹ˆé¦–é€‰50â€¯%
50â€¯%æ­£å¥½ä½äºæ›²çº¿ä¸­ç‚¹ï¼Œå……ç”µæ®µä¸æ”¾ç”µæ®µåœ¨è¿™é‡Œä¼šâ€œäº¤å‰æœ€å°åŒ–â€æåŒ–å·®ã€‚æŠŠä¸¤ä¾§åˆ†åˆ«çº¿æ€§æ ¡æ­£åˆ°åŒä¸€ç‚¹ï¼Œå¯ä»¥è®©ä½â€¯SOCå’Œé«˜â€¯SOCä¸¤ç«¯çš„è¯¯å·®åœ¨ä¸­é—´æŠµæ¶ˆï¼Œæ•´ä½“æ‹Ÿåˆè¯¯å·®æœ€å°ã€‚

ğŸ“Šæ•°å­¦ä¼˜åŠ¿
å……/æ”¾ç”µç”µå‹å¯è¿‘ä¼¼å†™æˆ OCVÂ±kÂ·IÂ·(1â€‘2â€¯SOC)ã€‚åœ¨ SOC=0.5 æ—¶ï¼ŒÂ±é¡¹å˜é›¶ï¼ŒæåŒ–åªä½“ç°ä¸ºå¸¸é‡Î´Vã€‚ä»¥è¯¥ç‚¹ä½œåŸºå‡†æ ¡æ­£ï¼Œå·¦å³ä¸¤ç«¯çº¿æ€§å¤–æ¨å³å¯è¿˜åŸ OCVã€‚

ğŸ”‹å®éªŒå¯è¡Œæ€§
ä¸­æ®µç”µæµæ³¢åŠ¨å°ã€æ¸©å‡ä½ï¼Œæµ‹é‡å™ªå£°æœ€å°ï¼›æåŒ–å·® Î´V ä¹Ÿè¾ƒç¨³å®šï¼Œå—å†å²å·¥å†µå½±å“å°‘ï¼Œç”¨æ¥æ ‡å®šæ›´å¯é ã€‚

ğŸ› ï¸èƒ½ç”¨åˆ«çš„ç‚¹å—
å¯ä»¥ï¼Œä½†éœ€åŒæ­¥ä¿®æ”¹æ ¡æ­£å…¬å¼ï¼š
â€¢ é€‰ x% æ—¶ï¼Œä½æ®µå‡ xÂ·Î´Vï¼Œé«˜æ®µåŠ  (1â€‘x)Â·Î´V
â€¢ x å¤ªä½æˆ–å¤ªé«˜ä¼šæ”¾å¤§å¦ä¸€ç«¯è¯¯å·®ï¼Œä¸”ç«¯ç‚¹å®¹é‡ä¼°è®¡æ›´ä¸ç¨³
â€¢ 50â€¯% ç»¼åˆè¯¯å·®ã€å™ªå£°ã€å®ç°éš¾åº¦æœ€å°ï¼Œå› æ­¤æœ€å¸¸ç”¨ã€‚

ğŸ“ˆå®åŠ¡å»ºè®®
è‹¥ä½ çš„ç”µæ± åœ¨ 40â€¯%ï½60â€¯% åŒºé—´æ»åæå°ï¼Œä¹Ÿå¯é€‰ 40â€¯% æˆ– 60â€¯% å¹¶æŒ‰ä¸Šå¼ä¿®æ­£ï¼›ä½†ç»“æœéœ€ä¸å¼€è·¯é™ç½®æµ‹å¾—çš„ OCV å¯¹æ¯”éªŒè¯ã€‚


## OCV and SOC
- OCV is equal to terminal voltage when disconnected(open)
- OCV is a function of SOC(State of Charge)
- OCV does not include I*R drop due to current flow nor time dependent effects
- OCV is also a function of temperature
- OCV is key to SOC estimation(ground truth)
- OCV is subject to hysteresis
```
- OCV ç­‰äºæ–­å¼€ï¼ˆå¼€è·¯ï¼‰æ—¶çš„ç«¯å­ç”µå‹
- OCV æ˜¯ SOCï¼ˆå……ç”µçŠ¶æ€ï¼‰çš„å‡½æ•°
- OCV ä¸åŒ…æ‹¬ç”µæµå¼•èµ·çš„ I*R å‹é™æˆ–æ—¶é—´ç›¸å…³æ•ˆåº”
- OCV ä¹Ÿæ˜¯æ¸©åº¦çš„å‡½æ•°
- OCV æ˜¯ SOC ä¼°ç®—çš„å…³é”®ï¼ˆåŸºæœ¬äº‹å®ï¼‰
- OCV å—è¿Ÿæ»å½±å“
```



# æ€»ä½“æ€è·¯
ä½œè€…è¦ä»æ…¢é€Ÿæ”¾ç”µâ€¯(stepâ€¯22â€¯/â€¯23)â€¯å’Œæ…¢é€Ÿå……ç”µâ€¯(stepâ€¯24)â€¯æ•°æ®ä¸­ï¼Œæ‰£æ‰â€¯*iÂ·R*â€¯ç”µå‹é™å¹¶å¯¹é½å……æ”¾ç”µæ›²çº¿ï¼Œä½¿å®ƒä»¬åœ¨â€¯50â€¯%â€¯SOCâ€¯å¤„æ±‡åˆï¼Œè¿›è€Œæ¨ç®—â€œå»æåŒ–â€åçš„çœŸå®â€¯OCVï¼›å¯¹â€¯25â€¯Â°Câ€¯ç®—å¥½åï¼Œå†ä¾æ¬¡å¤„ç†å…¶ä»–æ¸©åº¦å¹¶æ ¡æ­£ä¸åŒæ¸©åº¦ä¸‹çš„åº“ä¼¦æ•ˆç‡â€¯Î·ã€‚

ğŸ”¢ä¸»è¦æ­¥éª¤
1ï¸âƒ£**è½½å…¥æŒ‡å®šæ¸©åº¦ CSV**â†’æå–æ”¾ç”µ/å……ç”µç«¯ç”µå‹â€‘å®¹é‡â€‘Step åºåˆ—
2ï¸âƒ£**25â€¯Â°C**ï¼š
â€ƒâ€¢ è®¡ç®— Î·â‚‚â‚…=âˆ‘DisAh/âˆ‘ChgAhï¼Œç”¨å®ƒæŠŠå……ç”µå®¹é‡æ›²çº¿æ•´ä½“ç¼©æ”¾åˆ°ä¸æ”¾ç”µç›¸ç¬¦
â€ƒâ€¢ å–æ…¢æ”¾ç”µæ®µå¼€/ç»ˆç«¯çš„ç”µå‹è·³å˜ IRâ‚‚Dã€æ…¢å……ç”µæ®µçš„è·³å˜ IRâ‚C/IRâ‚‚Cï¼Œå†ç”¨ç»éªŒè§„åˆ™ç»™å››ä¸ª *iÂ·R* é™å€¼ï¼Œå¾—åˆ°éš SOC çº¿æ€§è¿‡æ¸¡çš„ IRblend
â€ƒâ€¢ æ”¾ç”µç«¯ç”µå‹+IRblendã€å……ç”µç«¯ç”µå‹âˆ’IRblend â†’ è¿‘ä¼¼æ‰£é™¤é˜»æŠ—åçš„ä¸¤æ¡â€œå‡†â€¯OCVâ€æ›²çº¿
â€ƒâ€¢ å– 50â€¯%â€¯SOC å¤„ä¸¤æ›²çº¿ç”µå‹å·® Î”Vâ‚…â‚€ï¼›ä½äº 0.5â€¯SOCâ€¯æ®µç”¨å……ç”µçº¿å‡ zÂ·Î”Vâ‚…â‚€ï¼Œé«˜äº 0.5 ç”¨æ”¾ç”µçº¿åŠ  (1âˆ’z)Â·Î”Vâ‚…â‚€ï¼Œä½¿ä¸­ç‚¹æ±‡åˆ
â€ƒâ€¢ æ‹¼æ¥â†’æ’å€¼åˆ°ç»Ÿä¸€ SOC æ …æ ¼ â†’ å¾— 25â€¯Â°C ä¸‹çš„ rawâ€¯OCV
3ï¸âƒ£**å…¶ä»–æ¸©åº¦**ï¼š
â€ƒâ€¢ å¯¹æ¯ä¸ªæ¸©åº¦è®¡ç®—è‡ªèº« Î·â‚–ï¼ŒåŒæ ·ç¼©æ”¾å……ç”µ Ah
â€ƒâ€¢ ç”¨ 25â€¯Â°C çš„å®¹é‡ Qâ‚‚â‚… æŠŠæ‰€æœ‰ SOC å½’ä¸€åŒ–åˆ°åŒä¸€åæ ‡
â€ƒâ€¢ é‡å¤ 25â€¯Â°C çš„ IRblendã€Î”Vâ‚…â‚€ æ ¡æ­£æµç¨‹ â†’ å¾—å„æ¸©åº¦ rawâ€¯OCV
4ï¸âƒ£ç»“æœä¿å­˜è¿› FileData å¹¶é€æ¸©åº¦ç»˜å›¾ï¼Œæ–¹ä¾¿åç»­æ‹Ÿåˆæˆ OCVâ€‘T æ¨¡å‹

âš™ï¸ç»†èŠ‚æ³¨é‡Šä¸¾ä¾‹

```python
# ---- æ…¢æ”¾ç”µæ®µï¼ˆstep 22ï¼‰æµ‹å°¾ç«¯ iÂ·R è·Œè½ ----------
indD  = np.where(p25.s1.disStep == 22)[0]
IR2Da = p25.s1.disV[indD[-1]+1] - p25.s1.disV[indD[-1]]

# ---- æ…¢å……ç”µæ®µï¼ˆstep 24ï¼‰æµ‹é¦–/å°¾ iÂ·R ä¸Šå‡ ----------
indC  = np.where(p25.s1.chgStep == 24)[0]
IR1Ca = p25.s1.chgV[indC[0]]   - p25.s1.chgV[indC[0]-1]
IR2Ca = p25.s1.chgV[indC[-1]]  - p25.s1.chgV[indC[-1]+1]

# ---- ç»éªŒé™å¹…ï¼šé¿å…å¼‚å¸¸å™ªå£°å¯¼è‡´é˜»æŠ—è¿‡å¤§/è¿‡å° ----------
IR1D = 2*IR2Ca                 # æ”¾ç”µèµ·å§‹å‹é™â‰ˆ2Ã—å……ç”µå°¾ç«¯å‹å‡
IR2D = min(IR2Da, 2*IR1Ca)     # æ”¾ç”µå°¾ç«¯å‹é™â‰¤2Ã—å……ç”µèµ·å§‹å‹å‡
IR1C = min(IR1Ca, 2*IR2Da)     # å……ç”µèµ·å§‹å‹å‡â‰¤2Ã—æ”¾ç”µå°¾ç«¯å‹é™
IR2C = IR2Ca                   # å……ç”µå°¾ç«¯ä¿æŒåŸæµ‹å€¼
```

ğŸ¯è¿™æ ·åšçš„ç›®çš„
âœ…å»æ‰ç¬æ—¶é˜»æŠ—å‹é™ï¼Œè®©æ›²çº¿æ¥è¿‘çœŸæ­£çš„å¼€è·¯ç”µå‹
âœ…ç”¨ Î”Vâ‚…â‚€ ç»Ÿä¸€è°ƒå¹³å……/æ”¾ç”µæ»åï¼Œè®© hysteresis ä¸­ç‚¹å¯¹é½ï¼Œæé«˜ OCV ç²¾åº¦
âœ…ä¸åŒæ¸©åº¦ä¸‹å†ä¹˜ä»¥å„è‡ª Î·ï¼Œä¿è¯å®¹é‡ä¸ SOC å¯¹åº”å…³ç³»ä¸€è‡´ï¼Œä»è€Œå¾—å‡º **OCV = f(SOC,â€¯T)** çš„åŸå§‹æ•°æ®ï¼Œä¾›åç»­å»ºæ¨¡ï¼ˆå‡½æ•° `OCVfromSOCtemp`Â å³ç”¨äºæŠŠå¤šæ¸©åº¦æ•°æ®æ‹Ÿåˆä¸ºå¯è°ƒç”¨æ¨¡å‹ï¼‰

## `ir_jumps()` å‡½æ•°åœ¨åšä»€ä¹ˆï¼Ÿ

åœ¨ç”µæ± æ…¢é€Ÿå……æ”¾ç”µæ›²çº¿ä¸­ï¼Œ\*\*æ›²çº¿çš„â€œé¦–â€‘å°¾ç¬è·³ï¼ˆjumpï¼‰â€\*\*ä¸»è¦æ¥è‡ªä¸¤éƒ¨åˆ†ï¼š

1. **æ¬§å§†é˜»æŠ—ï¼ˆIR drop / IR riseï¼‰**

   * å½“ç”µæµçªç„¶ç”±â€¯0â€¯â†’â€¯Iï¼ˆå¼€å§‹å……æ”¾ç”µï¼‰æˆ–â€¯Iâ€¯â†’â€¯0ï¼ˆç»“æŸå……æ”¾ç”µï¼‰æ—¶ï¼Œç«¯ç”µå‹ç¬é—´å˜åŒ–

     $$
       \Delta V_{\text{IR}} = I \times R_{\text{ohm}}
     $$
   * è¿™ä¸€è·³è·ƒå’ŒçœŸæ­£çš„åŒ–å­¦å¹³è¡¡ç”µå‹ï¼ˆOCVï¼‰æ— å…³ï¼Œå¿…é¡»å‰”é™¤ã€‚

2. **æåŒ–/ç”µåŒ–å­¦åŠ¨åŠ›å­¦å·®å¼‚**

   * ç”±äºæåŒ–ï¼Œå……ç”µæ›²çº¿æ•´ä½“é«˜äºæ”¾ç”µæ›²çº¿ï¼›ä½†åœ¨æå°ç”µæµï¼ˆC/20ï¼‰ä¸‹ï¼ŒæåŒ–éšæ—¶é—´å‡ ä¹çº¿æ€§è¡°å‡ï¼Œå¯ä»¥ç”¨çº¿æ€§å†…æ’+Î”V\_{50} æ–¹å¼ç»Ÿä¸€å¯¹é½ã€‚
   * é¦–å°¾è·³è·ƒä»ç„¶æ˜¯æœ€çªå‡ºçš„â€œå¼‚å¸¸å°–ç‚¹â€ï¼Œå› æ­¤å…ˆè¡Œä¿®æ­£å®ƒä»¬ï¼Œåé¢æ‰èƒ½æŠŠå‰©ä½™éƒ¨åˆ†çœ‹æˆâ€œè¿‘ä¼¼å¹³ç¼“æ›²çº¿â€åš Î”V\_{50} è°ƒå¹³ã€‚

---

å˜é‡å«ä¹‰

| å˜é‡       | å–å€¼ç‚¹                                   | ç‰©ç†æ„ä¹‰                      | æ–¹å‘(Â±) |
| -------- | ------------------------------------- | ------------------------- | ----- |
| **IR1D** | æ”¾ç”µå¼€å§‹ç¬é—´ï¼ˆæœ¬æ–‡æ²¡æœ‰ç›´æ¥æµ‹ï¼Œè®¾ä¸º 2Ã—IR2Cï¼Œè§ä¸‹ï¼‰          | æ”¾ç”µåˆå§‹ **ä¸Šå‡è·³**ï¼ˆç”±äºéª¤åœå……ç”µåç«‹å³æ”¾ç”µï¼‰ | +     |
| **IR2D** | æ”¾ç”µç»“æŸç¬é—´ï¼ˆ`dis.iloc[-2] â†’ dis.iloc[-1]`ï¼‰ | æ”¾ç”µå°¾ç«¯ **ä¸‹é™è·³**ï¼ˆç”µæµé™è‡³ 0ï¼‰      | âˆ’     |
| **IR1C** | å……ç”µå¼€å§‹ç¬é—´ï¼ˆ`chg.iloc[1] â†’ chg.iloc[0]`ï¼‰   | å……ç”µåˆå§‹ **ä¸‹é™è·³**ï¼ˆç”µæµç”± 0â†’+Iï¼‰    | âˆ’     |
| **IR2C** | å……ç”µç»“æŸç¬é—´ï¼ˆ`chg.iloc[-2] â†’ chg.iloc[-1]`ï¼‰ | å……ç”µå°¾ç«¯ **ä¸Šå‡è·³**ï¼ˆ+Iâ†’0ï¼‰        | +     |

> æ³¨æ„ï¼šç¬¦å·å–å†³äºâ€œå‡/é™â€ï¼Œä»£ç ä¸­ç›´æ¥ç”¨ç”µå‹å·® `V[nâ€‘1]Â âˆ’Â V[n]`ï¼Œæ— éœ€æ˜¾å¼å†™æ­£è´Ÿå·ã€‚

---

è®¡ç®—é€»è¾‘é€è¡Œæ‹†è§£

```python
IR2D = dis["Voltage"].iloc[-2] - dis["Voltage"].iloc[-1]
```

* **æ”¾ç”µå°¾ç«¯**çš„ä¸¤ç‚¹å·®å€¼ `Vâ‚‹â‚‚Â âˆ’Â Vâ‚‹â‚`ã€‚
* æ”¾ç”µåœ¨è¿›è¡Œä¸­æ—¶ç”µæµä¸º âˆ’Iï¼Œæœ€ç»ˆåœåˆ°Â 0â€¯Aï¼›å› æ­¤ **ç”µå‹ä¼šæŠ¬é«˜**ï¼ˆå‡å° IR dropï¼‰ï¼Œ`V[-1]`â€¯>â€¯`V[-2]`ï¼Œå·®å€¼**ä¸ºè´Ÿ**ï¼Œä»£è¡¨ä¸€æ¬¡ **å‘ä¸Šè·³è·ƒ** çš„å¹…å€¼ã€‚

```python
IR1C = chg["Voltage"].iloc[1]  - chg["Voltage"].iloc[0]
```

* **å……ç”µå¼€å§‹**ç¬é—´ï¼Œç”µæµ 0â€¯â†’â€¯+Iï¼Œç«¯ç”µå‹ä¼š **ç«‹åˆ»ä¸‹é™**ï¼›æ‰€ä»¥å·®å€¼é€šå¸¸ **ä¸ºæ­£**ï¼ˆ`V0` < `V1`ï¼‰ã€‚

```python
IR2C = chg["Voltage"].iloc[-1] - chg["Voltage"].iloc[-2]
```

* **å……ç”µç»“æŸ**æ—¶ +Iâ€¯â†’â€¯0ï¼Œç«¯ç”µå‹æŠ¬é«˜ï¼›å·®å€¼é€šå¸¸ **ä¸ºæ­£**ã€‚

---

ç»éªŒé™å¹…ï¼ˆä¸¤è¡Œ `min()` å’Œå€æ•°ï¼‰

çœŸå®æ•°æ®å¯èƒ½å«å™ªå£°æˆ–æ“ä½œä¸å®Œå…¨å¯¹ç§°ï¼š

* è‹¥ç›´æ¥ä½¿ç”¨ 4â€¯ä¸ªå·®å€¼ï¼Œå¯èƒ½å‡ºç°â€œæŸä¸ªè·³è·ƒå¼‚å¸¸å¤§/å°â€ï¼Œå¯¼è‡´åç»­çº¿æ€§å†…æ’å‡ºç°ç•¸å˜ã€‚
* å¸¸è§ç»éªŒè§„åˆ™ï¼š**åŒä¸€æ®µå……/æ”¾é¦–å°¾è·³è·ƒå¹…å€¼åº”åŒé‡çº§**ã€‚å› æ­¤é‡‡ç”¨ï¼š

```python
IR1D = 2 * IR2C        # è‹¥ç¼ºå®æµ‹ç‚¹ï¼Œç”¨å……ç”µå°¾è·³ Ã—2 ä¼°ç®—æ”¾ç”µé¦–è·³
IR2D = min(IR2D, 2*IR1C)
IR1C = min(IR1C, 2*IR2D)
```

1. **æ”¾ç”µå¼€å§‹ï¼ˆIR1Dï¼‰** ç›´æ¥ç¼ºå°‘è§‚æµ‹ï¼ˆå› ä¸ºçœŸæ­£æ”¾ç”µé¦–ç‚¹åœ¨å‰ä¸€å……ç”µå°¾ä¹‹åï¼Œå¯èƒ½è¢«è·³è¿‡ï¼‰ã€‚

   * å– **å……ç”µå°¾è·³**ï¼ˆIR2Cï¼‰Ã—2 ä½œä¸ºç²—ç•¥ä¸Šé™ï¼šæ”¾ç”µé¦–è·³ä¸€èˆ¬æ›´å¤§ï¼Œå› ä¸ºä»Â +I ç«‹åˆ»åˆ‡åˆ° âˆ’Iã€‚
2. **IR2D** ä¸ **IR1C** äº’ç›¸è®¾é™ï¼Œé¿å…ä¸€ä¸ªæç«¯å€¼é€ æˆçº¿æ€§æ ¡æ­£â€œè¿‡è¡¥/æ¬ è¡¥â€ã€‚

---

æœ€ç»ˆè¿”å›å››ä¸ªå€¼å¹²å˜›ç”¨ï¼Ÿ

```python
return IR1D, IR2D, IR1C, IR2C
```

* `calc_ocv()` ä¸­å°†å®ƒä»¬æ’è¿› **çº¿æ€§æ··åˆ**ï¼š

```python
blendD = np.linspace(0,1,len(dis))          # 0â†’1 æ”¾ç”µåºåˆ—
disVcor = dis.V + (IR1D + (IR2D-IR1D)*blendD)

blendC = np.linspace(0,1,len(chg))          # 0â†’1 å……ç”µåºåˆ—
chgVcor = chg.V - (IR1C + (IR2C-IR1C)*blendC)
```

â¬‡ï¸ **ç›®çš„**

1. **èµ·ç‚¹**ï¼šç»™æ•´æ®µæ›²çº¿åŠ /å‡å„è‡ªçš„é¦–è·³ï¼ˆIR1D,Â IR1Cï¼‰ã€‚
2. **ç»ˆç‚¹**ï¼šçº¿æ€§è¿‡æ¸¡åˆ°å°¾è·³ï¼ˆIR2D,Â IR2Cï¼‰ã€‚
3. ç»“æœæ˜¯æŠŠ *ä¸¤æ¡æ›²çº¿* çš„â€œçªå…€é˜¶æ¢¯â€å‰Šæˆå‡ ä¹è¿ç»­çš„æ–œç‡ï¼Œåç»­æ‰èƒ½ç”¨ **Î”Vâ‚…â‚€** æŠŠå……æ”¾ç”µä¸¤æ®µå†æ— ç¼æ‹¼æ¥ã€‚

---

å¯è§†åŒ–ç¤ºæ„

```
åŸå§‹ (ç¤ºæ„)                    æ ¡æ­£å (ç¤ºæ„)
  V                              V
  â”‚   â–„â–„â–„â–„â†IR1D                  â”‚
4.2â”‚  â–ˆ                          â”‚
    â–ˆ  â–„â–„â–„â–„â†IR2D                 â”‚
    â–ˆ â–ˆ                          â”‚
4.0â”‚â–ˆ â–ˆ    (discharge)           â”‚â–ˆ (dis)
    â–ˆ â–ˆ                          â”‚ â–ˆ
    â–ˆ â–ˆ                          â”‚ â–ˆ
3.8â”‚â–ˆ â–ˆ                          â”‚ â–ˆ
    â–ˆ â–ˆ                          â”‚ â–ˆ
    â–ˆâ–„â–ˆ                          â”‚ â–ˆâ–„â–„
    â–²  â–²  â–²  t                  â–²  â–²  â–²  t
    |  |  |                      |  |  |
   IR1C IR2C                    å·²çº¿æ€§è¡¥å¿
```

---

å°ç»“

* `ir_jumps()` åˆ©ç”¨ **é¦–æœ«ä¸¤ä¸ªé‡‡æ ·ç‚¹** ç®€å•ä¼°ç®—å››ä¸ªç¬æ—¶ IR è·³è·ƒå¹…å€¼ã€‚
* å†é€šè¿‡æç®€ç»éªŒé™å¹…é¿å…å™ªå£°ã€‚
* è¿™äº›è·³è·ƒéšåç”¨ **çº¿æ€§èåˆ** çš„æ–¹å¼ä»åŸå§‹ç”µå‹ä¸­æ‰£é™¤ï¼Œä»è€Œè·å¾—â€œç§»é™¤æ¬§å§†é˜»æŠ— + æåŒ–è¶‹åŠ¿ä¸€é˜¶è¿‘ä¼¼â€çš„ç”µå‹æ›²çº¿ï¼Œä¸º Î”Vâ‚…â‚€ è°ƒå¹³å’Œæœ€ç»ˆ OCV æ’å€¼æ‰“ä¸‹åŸºç¡€ã€‚


# VersionUp
ã‚‚ã—ä»Šå¾Œã•ã‚‰ã«æ©Ÿèƒ½è¿½åŠ ï¼ˆå¤šãƒ•ã‚¡ã‚¤ãƒ«ä¸€æ‹¬å‡¦ç†ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ UIãƒ»Plotly ã¸ã®åˆ‡ã‚Šæ›¿ãˆãªã©ï¼‰ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ï¼ˆDocker åŒ–ã€ç¤¾å†…ã‚µãƒ¼ãƒã¸ã®è¨­ç½®ãªã©ï¼‰ãŒå¿…è¦ã«ãªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚æ°—è»½ã«å£°ã‚’ã‹ã‘ã¦ãã ã•ã„ã­ã€‚


